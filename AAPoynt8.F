	   PROGRAM AAPOYNT8C      AUG 21, 2005C      FREE BOUNDARY, CONTOP. CASE	   IMPLICIT DOUBLE PRECISION (A-H,O-Z)	   REAL*8 P(402,402)      !! 	   REAL*8 PD(402,402)     !!	   REAL*8 HHP(402,402)    !!	   	   OPEN(4,FILE='LTCYLD.dat',STATUS='UNKNOWN')	   WRITE(4,204)204    FORMAT(X,'Z',X,'P',X,'HHP')	          OPEN(9,FILE='AAPOYNTPSI',STATUS='UNKNOWN',FORM='FORMATTED')	   WRITE(9,206)401,401     !!!!!!! (z,r)	   WRITE(9,206)0,0206    FORMAT(2I5)207    FORMAT(402F15.5)       WRITE(9,207)(0.01*(K-1),K=1,401)    !!!!!!!!!! z direction       WRITE(9,207)(0.01*(J-1),J=1,401)    !!!!!!!!!! r direction	   	   OPEN(10,FILE='AAHHP',STATUS='UNKNOWN',FORM='FORMATTED')	   WRITE(10,206)401,401     !!!!!!! (z,r)	   WRITE(10,206)0,0       WRITE(10,207)(0.01*(K-1),K=1,401)    !!!!!!!!!! z direction       WRITE(10,207)(0.01*(J-1),J=1,401)    !!!!!!!!!! r direction	   c123456	   PI=3.141592654D0	   NR=401	   NZ=401	   	   DR=0.01D0            !! r, z in units of rL	   DZ=0.01D0	   NL=101	   NLP=NL+1	   NLM=NL-1	   RL=DR*(NL-1)         !! light cylind. rad.	   DRDZ2=DR*DR/(DZ*DZ)	   ZMAX=DZ*(NZ-1)	   RMAX=DR*(NR-1)     !! light cyld. rad. = 1	   RLOVRS=10.D0       !! light cyld. rad./star's rad.	   RS=1.D0/RLOVRS     !! star's radius	   NRS=1+RS/DR	   NRSP=NRS+1C	   P0=0.2D0            !! flux fct. at edge of jet units of mu/rL	   EPS=0.1            !! for self over-relaxation	   CHHP=10.0D0         !! dim. coeff of H*HP	 	   	   	   DO K=1,NZ            ! along the z axis	    P(1,K)=0.D0	   END DO	   DO J=1,NLM            ! along the equatorial plane	    R=DR*(J-1)		IF(R.LE.RS) THEN		 TEMP=R*R*(RLOVRS**3)		ELSE		 TEMP=P(J,3)		ENDIF		 P(J,1)=TEMP	   END DO	    P(NL,1)=P(NLM,1)    !!! at z=0, rL	   DO J=NLP,NR          !!! at z=0, r > rL	    P(J,1)=P(NLM,2)	   END DO	   DO J=2,NL     !!!!! set up the initial flux  funct. INSIDE rL	    R=DR*(J-1)		DO K=2,NZ		 Z=DZ*(K-1)		 TEMP=R*R/(R*R+Z*Z)**1.5		 P(J,K)=TEMP		END DO	   END DO	   DO J=NLP,NR   !!!! set up the initial flux funct. OUTSIDE rL	    R=DR*(J-1)		DO K=2,NZ		 Z=DZ*(K-1)		 TAN=Z/R		 P(J,K)=1.D0/(1.D0+TAN*TAN)**1.5		END DO	   END DOC123456	       DO II=1,7000     !!!!!!!!! main iteration loop !!!!!!!!!!!!	   	   	   NRY=NLM    !! locate the Y point	   DO J=NRSP,NLM  !! locate the Y point	     R=DR*(J-1)		 BZN=-(R+0.5*DR)**2*(P(J+1,2)-P(J,2))/DR		 NRY=J		  IF(BZN.LT.0.02) GOTO 99	   END DO   !! end location99     XX=1.      		 	   DO J=1,NRY           !! along the equatorial plane	    R=DR*(J-1)          !! floating Y point		IF(R.LE.RS) THEN		 TEMP=R*R*(RLOVRS**3)		ELSE		 TEMP=P(J,3)		ENDIF		 P(J,1)=TEMP	   END DO	   C	    P(NL,1)=P(NLM,1)    !!! at z=0, rLC	   DO J=NLP,NR          !!! at z=0, r > rLC	    P(J,1)=P(NLM,2)C	   END DO              NRYP=NRY+1   !! floating Y point       DO J=NRYP,NR	     P(J,1)=P(NRY,2)	   END DO	   	   DO J=NLP,NR      !!!!!!!!! mixed bdyr condition	     TEM=P(J,2)-P(J,1)		  IF(TEM.GT.0.0) THEN		   P(J,1)=P(J,3)		  ENDIF	   END DO      !!!!!!!!!!!!!!!!!!!!!	   DO J=2,NR       !! free cond. along top bdyr		 P(J,NZ+1)=2.D0*P(J,NZ)-P(J,NZ-1)	   END DO	   DO K=2,NZ       !!  free cond. along rhs bdyr		 P(NR+1,K)=2.D0*P(NR,K)-P(NR-1,K)	   END DO 	   	   PCORN=P(NLM,NZ)   !! flx. fct. upper inside corner of rL	   HHPCORN=(P(NLP,NZ)-P(NLM,NZ))/DR	   PBOTL=P(NRY,2)    !! flx. fct. equat.plane inside of rL	   	   DO K=2,NZ      !! take care of lt.  cylind. points	     P(NL,K)=0.5D0*(P(NLM,K)+P(NLP,K))	   END DO	   	   DO J=2,NR      !!  calculate HHP	     DO K=2,NZ		  HHP(J,K)=0.D0	      PT=P(J,K)		  PTP=PT/PCORN		   IF(PTP.GT.0.0.AND.PTP.LT.1.D0) THEN		     HHP(J,K)=HHPCORN*PTP		   ENDIF		   IF(PT.GT.PBOTL) THEN		     HHP(J,K)=0.D0		   ENDIF		   IF(PTP.GT.1.0.AND.PT.LT.PBOTL)THEN	         DO KP=2,NZ			   PLKP=P(NL,KP)			   PLKPP=P(NL,KP+1)			   IF(PT.EQ.PLKP) THEN			     HHP(J,K)=(P(NL+1,KP)-P(NL-1,KP))/DR			   ENDIF			   IF(PT.EQ.PLKPP) THEN			     HHP(J,K)=(P(NL+1,KP+1)-P(NL-1,KP+1))/DR			   ENDIF		       SGN=(PT-PLKP)*(PT-PLKPP)			   IF(SGN.LT.0.0) THEN			     RAT=(PT-PLKPP)/(PLKP-PLKPP)			     TEM0=(P(NL+1,KP)-P(NL-1,KP))/DR			     TEMP=(P(NL+1,KP+1)-P(NL-1,KP+1))/DR			     HHP(J,K)=RAT*TEM0+(1.-RAT)*TEMP			   ENDIF		     END DO			ENDIF		  END DO	   END DO    !! end HHP calculation		 	   DO J=1,NR   !!  fill in edge values		   HHP(J,1)=HHP(J,2)	   END DO	   DO K=1,NZ		   HHP(1,K)=0.D0	   END DO      !!  end of edge values		   DO J=2,NR        !! save flux fct.	     DO K=2,NZ		  PD(J,K)=P(J,K)		 END DO	   END DO	   	   DO J=2,NLM         !! relax for r < rL	     R=DR*(J-1)		 DO K=2,NZ		    TEMR=P(J+1,K)+P(J-1,K)-2.D0*P(J,K)			TEMR=TEMR-0.5D0*(DR/R)*(P(J+1,K)-P(J-1,K))			TEMZ=DRDZ2*(P(J,K+1)+P(J,K-1)-2.D0*P(J,K))			 F1=DR*DR*HHP(J,K)-DR*R*(P(J+1,K)-P(J-1,K))             TEMS=F1/(1.D0-R*R)			P(J,K)=P(J,K)+EPS*(TEMR+TEMZ+TEMS)		  END DO	    END DO           !! end r<rL relax. loop	   	   DO J=NLP,NR      !! begin relax for r > rL	     R=DR*(J-1)		 DO K=2,NZ		    TEMR=P(J+1,K)+P(J-1,K)-2.D0*P(J,K)			TEMR=TEMR-0.5D0*(DR/R)*(P(J+1,K)-P(J-1,K))			TEMZ=DRDZ2*(P(J,K+1)+P(J,K-1)-2.D0*P(J,K))			 F1=DR*DR*HHP(J,K)-DR*R*(P(J+1,K)-P(J-1,K))             TEMS=F1/(1.-R*R)			 P(J,K)=P(J,K)+EPS*(TEMR+TEMZ+TEMS)		  END DO	    END DO           !! end r>rL relax. loop			  END DO           !! end of main iteration loop			   WRITE(*,*)'PCORN=', PCORN	   WRITE(*,*)'NRY=',NRY			   DO K=1,NZ	    WRITE(9,207)(P(J,K),J=1,NR)	   END DO	   DO K=1,NZ	    WRITE(10,207)(HHP(J,K),J=1,NR)	   END DO	   	   	   	SUMA=0.D0		SUMB=0.D0		DO J=2,NR		 DO K=2,NZ                		  SUMA=SUMA+DABS(P(J,K)-PD(J,K))		  SUMB=SUMB+DABS(P(J,K))		 END DO		END DO		WRITE(*,*)'II, RATIO=',II,SUMA/SUMB			   DO K=1,NZ	     Z=DZ*(K-1)	     WRITE(4,210)Z,P(NL,K),HHP(NL,K)	   END DO210    FORMAT(3F14.5)	   C123456              CLOSE(UNIT=10)       CLOSE(UNIT=9)	   CLOSE(UNIT=4)       PAUSE	   STOP	   END	   C	   REAL FUNCTION HHP(Z)C	     REAL*8 ZC		 S=4.D0/3.D0C		 S1=S-1.D0C		 HHP=S*((1.-Z)**S1)*(1.-(1.-Z)**S)C	   RETURNC	   END		